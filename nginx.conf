worker_processes auto;

events {
  worker_connections 1024;
}

http {
  include       mime.types;
  default_type  application/octet-stream;

  sendfile        on;
  tcp_nopush      on;
  tcp_nodelay     on;
  keepalive_timeout  65;
  server_tokens off;

  types {
    application/manifest+json webmanifest;
    application/json          json;
    image/svg+xml             svg;
    image/webp                webp;
  }

  gzip on;
  gzip_comp_level 6;
  gzip_min_length 1024;
  gzip_vary on;
  gzip_proxied any;
  gzip_types
    text/plain
    text/css
    text/javascript
    application/javascript
    application/json
    application/manifest+json
    image/svg+xml;


  server {
    listen 80;
    listen [::]:80;
    server_name vodka-casino.ru www.vodka-casino.ru;
    return 301 https://vodka-casino.ru$request_uri;
  }

  server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name www.vodka-casino.ru;

    ssl_certificate     /etc/ssl/vodka-casino/fullchain.pem; 
    ssl_certificate_key /etc/ssl/vodka-casino/privkey.pem;   
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    return 301 https://vodka-casino.ru$request_uri;
  }

  server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name vodka-casino.ru;

    ssl_certificate     /etc/ssl/vodka-casino/fullchain.pem; 
    ssl_certificate_key /etc/ssl/vodka-casino/privkey.pem;   
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    root /var/www/vodka-casino;
    index index.html amp.html deposit.html vivod.html;

    add_header X-Content-Type-Options nosniff always;
    add_header X-Frame-Options SAMEORIGIN always;
    add_header Referrer-Policy strict-origin-when-cross-origin always;
    add_header Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()" always;
    add_header Cross-Origin-Resource-Policy same-origin always;
    add_header Cross-Origin-Opener-Policy same-origin always;
    add_header Cross-Origin-Embedder-Policy unsafe-none always;

    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

    location = /sw.js {
      alias /var/www/vodka-casino/public/cache/sw.js;
      add_header Content-Type application/javascript charset=utf-8;
      add_header Service-Worker-Allowed "/" always;
      expires -1;
      add_header Cache-Control "no-cache, no-store, must-revalidate";
    }

    location = /manifest.webmanifest {
  alias /var/www/vodka-casino/public/cache/manifest.webmanifest;
  add_header Content-Type application/manifest+json charset=utf-8;
  expires 1y;
  add_header Cache-Control "public, max-age=31536000";
    }


    location = /favicon.ico   { alias /var/www/vodka-casino/public/cache/favicon.ico;  expires 7d;  add_header Cache-Control "public, max-age=604800, immutable"; }
    location = /logo192.png   { alias /var/www/vodka-casino/public/cache/logo192.png;  expires 30d; add_header Cache-Control "public, max-age=2592000, immutable"; }
    location = /logo512.png   { alias /var/www/vodka-casino/public/cache/logo512.png;  expires 30d; add_header Cache-Control "public, max-age=2592000, immutable"; }

    location /icons/ {
      alias /var/www/vodka-casino/public/cache/icons/;
      try_files $uri =404;
      expires 1y;
      add_header Cache-Control "public, max-age=31536000, immutable";
    }

    location /images/ {
      alias /var/www/vodka-casino/public/cache/images/;
      try_files $uri =404;
      expires 1y;
      add_header Cache-Control "public, max-age=31536000, immutable";
    }

    location /public/ {
      alias /var/www/vodka-casino/public/cache/;
      try_files $uri =404;

      location ~* \.(?:css|js)$ {
        expires 30d;
        add_header Cache-Control "public, max-age=2592000, immutable";
      }
      location ~* \.(?:png|jpe?g|gif|svg|webp|ico)$ {
        expires 1y;
        add_header Cache-Control "public, max-age=31536000, immutable";
      }
      location ~* \.(?:json|webmanifest)$ {
        expires 1h;
        add_header Cache-Control "public, max-age=3600";
      }
    }

    location ~* \.(?:css|js)$ {
      expires 30d;
      add_header Cache-Control "public, max-age=2592000, immutable";
    }

    location ~* \.(?:png|jpe?g|gif|svg|webp|ico)$ {
      expires 1y;
      add_header Cache-Control "public, max-age=31536000, immutable";
    }

    location ~* \.(?:json|webmanifest)$ {
      expires 1h;
      add_header Cache-Control "public, max-age=3600";
    }

    location / {
      try_files $uri $uri/ $uri.html /public/cache/amp.html;
      add_header Cache-Control "no-cache, no-store, must-revalidate";
      expires -1;
    }

    location ~ /\.(?!well-known) {
      deny all;
    }

    location = /robots.txt {
      default_type text/plain;
      try_files $uri =404;
      expires 1d;
      add_header Cache-Control "public, max-age=86400";
    }

    location = /sitemap.xml {
      default_type application/xml;
      try_files $uri =404;
      expires 1h;
      add_header Cache-Control "public, max-age=3600";
    }

    error_page 404 /public/cache/amp.html;

    access_log /var/log/nginx/vodka-casino.access.log;
    error_log  /var/log/nginx/vodka-casino.error.log warn;
  }
}
